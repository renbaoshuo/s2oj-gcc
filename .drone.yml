---
kind: pipeline
type: docker
name: Build

trigger:
  event:
    - push
    - custom

steps:
  - name: Build & Upload
    image: ubuntu:22.04
    commands:
      - sed -i 's@//.*archive.ubuntu.com@//mirror-cdn.xtom.com@g' /etc/apt/sources.list &&
        sed -i 's@//security.ubuntu.com@//mirror-cdn.xtom.com@g' /etc/apt/sources.list
      - apt update &&
        apt install -y git make gcc libgmp-dev libmpfr-dev libmpc-dev gcc-multilib
      - bash build.sh
    environment:
      GITEA_ENDPOINT: https://git.m.ac
      GITEA_USER: baoshuo
      GITEA_TOKEN:
        from_secret: GITEA_TOKEN
